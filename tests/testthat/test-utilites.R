test_that("edge_corr_wt", {
  set.seed(2020)
  tp <- hberg_beech
  s_loc <- xy_sample(hberg_beech$boundary, n=10, M=1, method="random")
  resp <- fixed_area(tp, s_loc, r=10)
  ts <- extract_data(tp, resp)

  expect_equal(
    edge_corr_wt(tree_pop=tp, tree_sample=ts, sample_loc=s_loc),
    structure(
      list(
        data=data.table::data.table(
          id_tree=c(144L, 145L, 147L, 146L, 211L, 149L, 41L, 26L, 28L, 23L, 24L,
                    32L, 22L, 27L, 29L, 25L, 30L, 200L, 195L, 128L, 196L, 127L, 197L,
                    126L, 90L, 90L, 92L, 20L, 69L, 68L, 70L, 201L, 21L, 37L, 46L,
                    47L, 45L, 137L, 48L, 99L, 136L, 158L, 157L, 259L, 258L, 113L,
                    159L, 260L, 245L, 246L, 247L, 193L, 172L, 174L, 248L, 243L),
          id_stem=c(144L, 145L, 147L, 146L, 211L, 149L, 41L, 26L, 28L, 23L, 24L,
                    32L, 22L, 27L, 29L, 25L, 30L, 200L, 195L, 128L, 196L, 127L, 197L,
                    126L, 90L, 90L, 92L, 20L, 69L, 68L, 70L, 201L, 21L, 37L, 46L,
                    47L, 45L, 137L, 48L, 99L, 136L, 158L, 157L, 259L, 258L, 113L,
                    159L, 260L, 245L, 246L, 247L, 193L, 172L, 174L, 248L, 243L),
          x_tree=c(77.94, 77.55, 82.05, 78.24, 74.63, 88.13, 77.07, 10.86, 9.39,
                   12, 14.52, 3.59, 9.24, 1.28, 14.87, 16.92, 15.16, 17.31, 34.57,
                   24.2, 28.76, 28.37, 28.62, 24.44, 71.95, 71.95, 61.99, 18.05,
                   18.71, 26.2, 27.45, 23.3, 12.59, 0, 36.68, 35.36, 34.82, 40.83,
                   30.29, 31.42, 42.41, 40.92, 42.82, 34.84, 30.47, 40.08, 41.19,
                   35.78, 97.09, 96.34, 90.06, 100.96, 93.52, 94.9, 88.35, 97.33),
          y_tree=c(11.21, 13.35, 12.63, 16.64, 10.09, 14.42, 21.89, 34.15, 30.67,
                   38.81, 38.4, 27.55, 41.22, 36.27, 27.83, 36.85, 26.64, 38.01,
                   20.21, 19.11, 24.82, 12.25, 27.96, 11.65, 111.53, 111.53, 105.79,
                   48.67, 55.26, 55.43, 42.54, 40.69, 47.69, 74.18, 102.85, 102.4,
                   108.8, 106.65, 103.04, 98.87, 101.33, 84.64, 81.16, 74.35, 77.66,
                   73.63, 87.41, 71.08, 67.17, 61.1, 63.33, 70.28, 59.58, 58.35,
                   64.33, 73.82),
          is_dead=c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
          dbh=c(15, 43.8, 48.5, 47.3, 44.7, 56.9, 10, 59, 13.2, 55.4, 10.9,
                68.1, 14.7, 60.4, 48.4, 24.5, 20.3, 50.2, 15.6, 31, 29.1, 25.4,
                16.9, 46.2, 56.8, 56.8, 48.9, 30.3, 48.7, 58, 54.3, 39.8, 57.9,
                13.9, 19.1, 19.3, 52.8, 65.6, 21.1, 51.8, 26, 64.7, 62.8, 64.2,
                25.3, 21.2, 23.6, 13.3, 19.2, 59.1, 52.3, 18.4, 11.8, 25.6, 17.4,
                58.5),
          species=c("Fagus sylvatica", "Fagus sylvatica", "Fagus sylvatica", "Fagus sylvatica",
                    "Fagus sylvatica", "Fagus sylvatica", "Acer sp.", "Fagus sylvatica",
                    "Fagus sylvatica", "Fagus sylvatica", "Fagus sylvatica", "Fagus sylvatica",
                    "Fagus sylvatica", "Fagus sylvatica", "Fagus sylvatica", "Fagus sylvatica",
                    "Fagus sylvatica", "Fagus sylvatica", "Ulmus minor", "Fagus sylvatica",
                    "Fagus sylvatica", "Fagus sylvatica", "Fagus sylvatica", "Acer pseudoplatanus",
                    "Fagus sylvatica", "Fagus sylvatica", "Quercus petrea", "Acer pseudoplatanus",
                    "Fagus sylvatica", "Fagus sylvatica", "Fagus sylvatica", "Fagus sylvatica",
                    "Fagus sylvatica", "Acer pseudoplatanus", "Fagus sylvatica",
                    "Fagus sylvatica", "Fagus sylvatica", "Fagus sylvatica", "Fagus sylvatica",
                    "Fraxinus excelsior", "Fagus sylvatica", "Fagus sylvatica", "Fagus sylvatica",
                    "Quercus robur", "Carpinus betulus", "Fagus sylvatica", "Fagus sylvatica",
                    "Fagus sylvatica", "Fagus sylvatica", "Fraxinus excelsior", "Fagus sylvatica",
                    "Fagus sylvatica", "Fagus sylvatica", "Fagus sylvatica", "Fagus sylvatica",
                    "Fagus sylvatica"),
          ba=c(0.02, 0.15, 0.18, 0.18, 0.16, 0.25, 0.01, 0.27, 0.01, 0.24,
               0.01, 0.36, 0.02, 0.29, 0.18, 0.05, 0.03, 0.2, 0.02, 0.08, 0.07,
               0.05, 0.02, 0.17, 0.25, 0.25, 0.19, 0.07, 0.19, 0.26, 0.23, 0.12,
               0.26, 0.02, 0.03, 0.03, 0.22, 0.34, 0.03, 0.21, 0.05, 0.33, 0.31,
               0.32, 0.05, 0.04, 0.04, 0.01, 0.03, 0.27, 0.21, 0.03, 0.01, 0.05,
               0.02, 0.27),
          n=c(1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
              1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
              1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
              1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L),
          f_edge=c(1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 2L, 1L, 2L, 1L,
                   1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
                   1L, 1L, 2L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
                   1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L),
          id_sample=c(1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
                      1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
                      1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
                      1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L),
          id_point=c(1L, 1L, 1L, 1L, 1L, 1L, 1L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L,
                     2L, 2L, 2L, 3L, 3L, 3L, 3L, 3L, 3L, 4L, 5L, 5L, 6L, 6L, 6L, 6L,
                     6L, 6L, 7L, 8L, 8L, 8L, 8L, 8L, 8L, 8L, 9L, 9L, 9L, 9L, 9L, 9L,
                     9L, 10L, 10L, 10L, 10L, 10L, 10L, 10L, 10L),
          ef=c(31.83, 31.83, 31.83, 31.83, 31.83, 31.83, 31.83, 31.83, 31.83,
               31.83, 31.83, 31.83, 31.83, 31.83, 31.83, 31.83, 31.83, 31.83,
               31.83, 31.83, 31.83, 31.83, 31.83, 31.83, 31.83, 31.83, 31.83,
               31.83, 31.83, 31.83, 31.83, 31.83, 31.83, 31.83, 31.83, 31.83,
               31.83, 31.83, 31.83, 31.83, 31.83, 31.83, 31.83, 31.83, 31.83,
               31.83, 31.83, 31.83, 31.83, 31.83, 31.83, 31.83, 31.83, 31.83,
               31.83, 31.83)
        ),
        r_design = "fixed_area",
        r_design_parm = 10),
      class = "tree_sample"),
    tolerance=5e-2)
})
